<div class="container">
    <h1>Bonus Computation Sheet</h1>

    <form [formGroup]="recordForm" (ngSubmit)="onSubmit()">
        <fieldset>
            <legend><strong>General Information</strong></legend>
            <div class="info-box">
                <div *ngIf="salesman">
                    <p><strong>Name:</strong> {{ salesman.firstname }} {{ salesman.lastname }}</p>
                    <p><strong>Employee ID:</strong> {{ salesman.code }}</p>
                    <p><strong>Department:</strong> {{ salesman.department }}</p>
                </div>
                <div class="form-group">
                    <label for="year"><strong>Year:</strong></label>
                    <input
                        id="year"
                        formControlName="year"
                        type="number"
                        placeholder="Enter year"
                    />
                    <div *ngIf="recordForm.get('year')?.invalid && recordForm.get('year')?.touched" class="error">
                        <small *ngIf="recordForm.get('year')?.errors?.['required']">Year is required.</small>
                    </div>
                </div>
                <button mat-raised-button color="primary" type="button" (click)="onGetOrderEvaluation()">Fetch Orders</button>
            </div>
        </fieldset>

        <fieldset>
            <legend><strong>A.) Orders Evaluation</strong></legend>
            <table>
                <thead>
                <tr>
                    <th>Name of Product</th>
                    <th>Client</th>
                    <th>Client Ranking</th>
                    <th>Items</th>
                </tr>
                </thead>
                <tbody>
                <tr *ngFor="let order of salesOrders">
                    <td>
                        <!-- Anzeige des Produktnamens -->
                        {{ order.productName }}
                    </td>
                    <td *ngFor="let client of order.clients">
                        <!-- Anzeige des Kundennamens -->
                        {{ client.customerName }}
                    </td>
                    <td *ngFor="let client of order.clients">
                        <!-- Anzeige des Kunden-Rankings -->
                        {{ client.rating }}
                    </td>
                    <td *ngFor="let client of order.clients">
                        <!-- Anzeige der bestellten Menge (items) -->
                        {{ client.quantity }}
                    </td>
                </tr>
                </tbody>

            </table>
        </fieldset>


        <fieldset>
            <legend><strong>B.) Social Performance Evaluation</strong></legend>
            <p>Fill in the actual values for each category to calculate the bonus.</p>
            <table>
                <thead>
                <tr>
                    <th>Category</th>
                    <th>Target Value</th>
                    <th>Actual Value</th>
                </tr>
                </thead>
                <tbody>
                <tr *ngFor="let competence of competencesControls; let i = index">
                    <td>{{ competence.value.name }}</td>
                    <td>{{ competence.value.targetValue }}</td>
                    <td>
                        <input
                            [formControl]="competence.get('actualValue')"
                            type="number"
                            placeholder="Enter actual value"
                            min="0"
                            max="4"
                        />
                        <!-- Optionale Fehlermeldung -->
                        <div *ngIf="competence.get('actualValue')?.invalid && competence.get('actualValue')?.touched" class="error">
                            <small *ngIf="competence.get('actualValue')?.errors?.['required']">Value is required.</small>
                            <small *ngIf="competence.get('actualValue')?.errors?.['min']">Value must be 0 or greater.</small>
                            <small *ngIf="competence.get('actualValue')?.errors?.['max']">Value must be 4 or less.</small>
                        </div>
                    </td>
                </tr>
                </tbody>
            </table>
        </fieldset>

        <button mat-raised-button color="primary" type="submit" [disabled]="recordForm.invalid">Submit</button>
    </form>
</div>
